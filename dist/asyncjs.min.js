!function(t,n){"use strict";function a(t,n){var a=t.length;return~n&&a>n&&(a=n),a}function e(t){y(function(){throw t})}function r(t){return/(^(https?:)?\/\/)|(\.js$)/.test(t)&&!/(\n|\r)/m.test(t)}function o(t){return t.constructor&&t.call&&t.apply}function s(t){return Array.isArray?Array.isArray(t)?t:[t]:g.concat(t)}function i(t){function n(t){return g.concat.apply(a,t)}var a=g.slice.call(arguments,1);return function(){return x.apply(t,n(arguments))}}function c(t,n,a){var r=this,o=null;if((!r.readyState||/^c|loade/.test(r.readyState))&&!r.loadStatus){if(n&&a){var s=r.src||"Resource",i=" fails to load.";o={name:"ConnectionError",source:s,evt:a,stack:s+i,message:i,toString:function(){return this.stack}},e(o)}r.onload=r.onreadystatechange=null,r.loadStatus=!0,t.call(null,o)}}function l(t,n){var a=document,e="script",r=a.createElement(e),o=a.getElementsByTagName(e),s=o[o.length-1];if(r.async=!0,r.src=t,n){r.loadStatus=!1;var l=!0,u=i(c,r,n);r.onload=r.onreadystatechange=u,r.onerror=i(u,null,l);var f=s;f=f||document.head.firstChild,f.parentNode.insertBefore(r,f)}}function u(t,n){y(function(){var a,r=o(t)?t:Function(t);try{r.call(null)}catch(s){a=s,a.source=t,e(a)}n.call(null,a)})}function f(t,n){if(!o(t)){if(r(t))return l(t,n),void 0;if(v)return t=k+encodeURIComponent(t),l(t,n),void 0}u(t,n)}function d(t,n){var a=this;a.tasks=[],a.callbacks=[],a.errors=[],a.nextTask=0,a.nextCallback=0;var e=-1;a.until=function(){return e},a.waitFor=function(t){e=t};var r=!1;a.digest=function(){return r},a.setDigest=function(t){r=t},a.add(t).whenDone(n)}function p(){var t=this;if(t.digest())return y(i(p,t)),void 0;t.setDigest(!0);for(var n,e,r=t.nextCallback;r<a(t.callbacks,t.until());r++)if(t.nextTask===t.tasks.length){if(e=t.nextCallback,n=t.callbacks[e]){if(t.nextCallback=r+1,n.call(null,t,t.nextTask-1,t.errors),!n.untilThen)continue;t.nextCallback--,t.waitFor(-1)}t.callbacks.splice(e,1)}t.setDigest(!1)}function h(t){var n=this;t&&n.errors.push(t),n.nextTask<n.tasks.length&&++n.nextTask!==n.tasks.length||p.call(n)}var k="data:application/javascript,",v=!0;navigator&&"ie"!==navigator.appName&&navigator.appVersion<8&&(v=!1);var y=function(t){setTimeout(t,50/3)},g=Array.prototype,x=Function.call;d.resolve=h,d.prototype.whenDone=function(t){var n=this;return t?n.nextTask>n.tasks.length?n:(n.callbacks.push(t),n.nextTask===n.tasks.length&&h.call(n),n):n},d.prototype.add=function(t){t=s(t);for(var n=0,a=i(h,this);n<t.length;n++)t[n]&&(this.tasks.push(t[n]),f(t[n],a));return this},d.prototype.addSync=function(t){function n(){a.waitFor(a.nextCallback),a.add(t)}var a=this;return t?a.nextTask===a.tasks.length?(a.add(t),a):(n.untilThen=!0,a.whenDone(n)):a},d.prototype.then=d.prototype.addSync;var m=function(t,n){return new d(t,n)};"object"==typeof exports?module.exports=m:"function"==typeof define&&define.amd?define(function(){return m}):n[t]=m}("asyncJS",this);