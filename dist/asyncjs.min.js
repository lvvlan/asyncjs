!function(t,n){"use strict";function e(t,n){var e=t.length;return~n&&e>n&&(e=n),e}function a(t,n){setTimeout(t,n||0)}function r(t){a(function(){throw t})}function o(t){return/(^(https?:)?\/\/)|(\.js$)/.test(t)&&!/(\n|\r)/m.test(t)}function l(t){return t.constructor&&t.call&&t.apply}function s(t){var n;return(n=Array.isArray)?n(t)?t:[t]:U.concat(t)}function i(t){function n(t){return U.concat.apply(e,t)}var e=U.slice.call(arguments,1);return function(){return A.apply(t,n(arguments))}}function c(t,n,e){var a=this,o=null;if((!a.readyState||/^c|loade/.test(a.readyState))&&!a.loadStatus){if(n&&e){var l=a.src||"Resource",s=" fails to load.";o={name:"ConnectionError",source:l,evt:e,stack:l+s,message:s,toString:function(){return this.stack}},r(o)}a.onload=a.onreadystatechange=null,a.loadStatus=!0,t.call(null,o)}}function u(t,n){var e="script",a=y.createElement(e),r=y.getElementsByTagName(e),o=r[r.length-1];if(a.async=!0,a.src=t,n){a.loadStatus=!1;var l=!0,s=i(c,a,n);a.onload=a.onreadystatechange=s,a.onerror=i(s,null,l);var u=o;u=u||document.head.firstChild,u.parentNode.insertBefore(a,u)}}function d(t,n){m(function(){var e,a=l(t)?t:Function(t);try{a.call(null)}catch(o){e=o,e.source=t,r(e)}n.call(null,e)})}function f(t,n){if(!l(t)){if(o(t))return u(t,n),void 0;if(b)return t=g+encodeURIComponent(t),u(t,n),void 0}d(t,n)}function p(t,n){var e=this;e.tasks=[],e.callbacks=[],e.errors=[],e.nextTask=0,e.nextCallback=0,e.until=-1,e.digest=!1,e.add(t).whenDone(n)}function h(){var t=this;if(t.digest)return a(i(h,t),50/3),void 0;t.digest=!0;for(var n,r,o=t.nextCallback;o<e(t.callbacks,t.until);o++)if(t.nextTask===t.tasks.length){if(r=t.nextCallback,n=t.callbacks[r]){if(t.nextCallback=o+1,n.call(null,t,t.nextTask-1,t.errors),!n.untilThen)continue;t.nextCallback--,t.until=-1}t.callbacks.splice(r,1)}t.digest=!1}function v(t){var n=this;t&&n.errors.push(t),n.nextTask<n.tasks.length&&++n.nextTask!==n.tasks.length||h.call(n)}function k(t,n){return new p(t,n)}var g="data:application/javascript,",y=document,b=!0;y.all&&!y.addEventListener&&(b=!1);var m,x=window,w=x.URL||x.webkitURL,B=x.BlobBuilder||x.WebKitBlobBuilder||x.MozBlobBuilder||x.MSBlobBuilder;if(x.postMessage&&x.Worker&&w&&(x.Blob||B)){var T,S="text/javascript",C={},j=0,E="self.onmessage = function(e) {self.postMessage(e.data);};";try{T=new Blob([E],{type:S})}catch(L){var M=new B;M.append(E),T=M.getBlob(S)}var R=new Worker(w.createObjectURL(T));R.addEventListener("message",function(t){var n=t.data;if(n){var e=C[n]||null;e&&(e.call(null),delete C[n])}}),m=function(t){var n="asyncJS-thread-"+ ++j;C[n]=t,R.postMessage(n)}}else m=window.setImmediate?function(t){setImmediate(t)}:a;var U=Array.prototype,A=Function.call;p.resolve=v,p.prototype.whenDone=function(t){var n=this;return t?n.nextTask>n.tasks.length?n:(n.callbacks.push(t),n.nextTask===n.tasks.length&&v.call(n),n):n},p.prototype.add=function(t){t=s(t);for(var n=0,e=i(v,this);n<t.length;n++)t[n]&&(this.tasks.push(t[n]),f(t[n],e));return this},p.prototype.addSync=function(t){function n(){e.until=e.nextCallback,e.add(t)}var e=this;return t?e.nextTask===e.tasks.length?(e.add(t),e):(n.untilThen=!0,e.whenDone(n)):e},p.prototype.then=p.prototype.addSync,"object"==typeof exports?module.exports=k:"function"==typeof define&&define.amd?define(function(){return k}):n[t]=k}("asyncJS",this);