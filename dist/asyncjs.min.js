!function(t,e){"use strict";function n(t,e){var n=t.length;return~e&&n>e&&(n=e),n}function r(t,e){T.setTimeout(t,e||0)}function a(t){r(function(){throw t})}function o(t){return/(^(https?:)?\/\/)|(\.(js|php)$)/.test(t)&&!/(\n|\r)/m.test(t)}function s(t){return t&&t.constructor&&t.call&&t.apply}function i(t){var e;return(e=Array.isArray)?e(t)?t:[t]:C.concat(t)}function c(t){return C.slice.call(t)}function l(){var t=c(arguments);return function(){return S.apply(S,t.concat(c(arguments)))}}function u(t,e){var n=this;if((!n.readyState||/^c|loade/.test(n.readyState))&&!n.loadStatus){if(n.onload=n.onreadystatechange=n.onerror=null,n.loadStatus=!0,e&&"error"===e.type){var r=n.src||"Resource",o=" fails to load.",s={name:"ConnectionError",source:r,evt:e,stack:r+o,message:o,toString:function(){return this.source+this.message}};return a(s),t.reject(s),void 0}t.resolve()}}function f(t,e){var n="script",r=b.createElement(n),a=b.getElementsByTagName(n),o=a[a.length-1];if(r.async=!0,r.src=t,e){r.loadStatus=!1;var s=l(u,r,e);r.onload=r.onreadystatechange=r.onerror=s;var i=o;i=i||document.body.firstChild,i.parentNode.insertBefore(r,i)}}function d(t,e){w(function(){try{t.call(null,e)}catch(n){e.reject(n)}})}function h(t,e){if(!s(t)){if(o(t))return f(t,e),void 0;if(j)return t=g+encodeURIComponent(t),f(t,e),void 0}var n=s(t)?t:Function(t);if(!e.async){var r=n;n=function(t){try{r.call(null),t.resolve()}catch(e){t.reject(e)}}}d(n,e)}function v(t,e){var n=this;n.tasks=[],n.callbacks=[],n.errors=[],n.data={},n.nextTask=0,n.nextCallback=0,n.until=-1,n.digest=!1,n.resolve=l(k,n),n.reject=l(m,n),n.add(t).whenDone(e)}function p(){var t=this;if(t.digest)return r(l(p,t),50/3),void 0;t.digest=!0;for(var e,a,o=t.nextCallback;o<n(t.callbacks,t.until);o++)if(t.nextTask===t.tasks.length){if(a=t.nextCallback,e=t.callbacks[a]){if(t.nextCallback=o+1,e.call(null,t,t.nextTask-1,t.errors),!e.untilThen)continue;t.nextCallback--,t.until=-1}t.callbacks.splice(a,1)}t.digest=!1}function k(t,e){var n=this;t&&t!==x&&(n.data[t]=e),n.nextTask<n.tasks.length&&++n.nextTask!==n.tasks.length||p.call(n)}function m(t){var e=this;t&&(a(t),e.errors.push(t)),k.call(e)}function y(t,e){return new v(t,e)}var g="data:application/javascript,",x="OMITTED",b=document,T=window,C=Array.prototype,j=!0;b.all&&!b.addEventListener&&(j=!1);var w=T.requestAnimationFrame||T.webkitRequestAnimationFrame||T.mozRequestAnimationFrame||r,S=Function.call;v.resolve=k,v.reject=m,v.prototype.whenDone=function(t){var e=this;return t?e.nextTask>e.tasks.length?e:(e.callbacks.push(t),e.nextTask===e.tasks.length&&k.call(e),e):e},v.prototype.add=function(t,e){var n=this;if(!t)return n;if(e&&n[e]){var r=new Error("Callback value name: "+e+" is registered");a(r),n.errors.push(r)}t=i(t);for(var o,s=0,c={resolve:l(k,n,e),reject:n.reject,async:!!e};s<t.length;s++)o=t[s],o&&(n.tasks.push(o),h(o,c));return n},v.prototype.then=function(t){function e(){n.until=n.nextCallback,n.add(t)}var n=this;return t?n.nextTask===n.tasks.length?n.add(t):(e.untilThen=!0,n.whenDone(e)):n},"undefined"!=typeof module&&module.exports?module.exports=y:"function"==typeof define&&define.amd?define(function(){return y}):e[t]=y}("asyncJS",this);